
#############################################################################
## index definition
#############################################################################

index geocities {
   type  = distributed
			agent = 10.39.138.89:9312|10.39.137.120:9312|10.39.138.1:9312:geocities[ha_strategy = noerrors]


}

index postal_coords {
	type  = distributed
 agent = 10.39.138.89:9312|10.39.137.120:9312|10.39.138.1:9312:postal_coords[ha_strategy = noerrors]

}

index admin_search_employers_rt {
    type  = distributed
    #During index alterations - delete cluster and make changes just to main index while others are serving old data
				#######agent = 10.39.137.120:9312|10.39.138.1:9312:admin_search_employers_rt[ha_strategy = noerrors, retry_count=80]
				agent = 10.39.138.89:9312|10.39.137.120:9312|10.39.138.1:9312:admin_search_employers_rt[ha_strategy = noerrors]
}

index jobs {
    type  = distributed
    agent = 10.39.138.89:9312|10.39.137.120:9312|10.39.138.1:9312:jobs[ha_strategy = noerrors]
}

index jobs_completions_custom {
 type  = distributed
 agent = 10.39.138.89:9312|10.39.137.120:9312|10.39.138.1:9312:jobs_completions_custom[ha_strategy = noerrors]

}

index requirements {
    type  = distributed
    agent = 10.39.138.89:9312|10.39.137.120:9312|10.39.138.1:9312:requirements[ha_strategy = noerrors]
}

index cvs {
    type  = distributed
    agent = 10.39.138.89:9312|10.39.137.120:9312|10.39.138.1:9312:cvs[ha_strategy = noerrors]
}

#############################################################################
## indexer settings
## Max memory for indexer is 2047Mb internal limit
#############################################################################

indexer
{
	mem_limit				= 2046M
	lemmatizer_cache 		= 256M
}

#############################################################################
## common settings
#############################################################################

common
{
	lemmatizer_base		= /etc/manticoresearch/dict/
}

#############################################################################
## searchd settings
#############################################################################
        #Sometimes need to inspect slow queries by enabling log
        #log = /var/log/manticore/searchd.log
        #query_log = /var/log/manticore/query.log
        #pid_file = /var/run/manticore/searchd.pid
        #data_dir is used ONLY IN RT_MODE, we use plain_mode
        #data_dir = /var/lib/manticore
        #query_log_format = sphinxql

searchd
{
 server_id               = 2
 max_open_files          = 10000
 network_timeout         = 5
 client_timeout          = 300
	#Retry times per agent , not a total retries
	#1. retry happens for each separate query, it doesn't matter if 10 are sent at once or just 1
	#2. by increasing retry_count for non-roundrobin HA strategies you increase the chance of a success of the request
    #since all the other strategies are based on random select and it can happen that the first N retries will select the bad node,
	#but N+1th will be for sure sent to another agent. nodeads/noerrors help to lower this effect by excluding the bad node from the list,
	#but it may take some time and given you have a high QPS you may still get few errors if the retry count is too low
	#since a query will may still be routed to a bad node not yet excluded from the list.
	#This setting is set on each index giving only MAX N retries in total, not N retries per agent in index
	agent_retry_count       = 80 #Tries each agent N times, if 2 agents, then total 4 times could be tried with 2 retries setting if both agents are dead
	agent_retry_delay       = 2
	agent_connect_timeout   = 20
	agent_query_timeout     = 3000
	threads                 = 32
	pseudo_sharding         = 1
	net_workers             = 1
	read_buffer_docs        = 256K
	read_buffer_hits        = 256K
	pid_file                = /var/run/manticore/searchd.pid
	seamless_rotate         = 1
	preopen_indexes         = 1
	unlink_old              = 1
	max_packet_size         = 128M
	max_filters             = 256
	max_filter_values       = 4096
	expansion_limit         = 10
	log = /var/log/manticore/searchd.log
	binlog_path = /var/lib/manticore/data
	query_log = /var/log/manticore/query.log
	query_log_format        = sphinxql
	#query_log_commands     = 1
	#Comment out time in order to Log all queries
	query_log_min_msec      = 60
		
		
}

# --eof--
